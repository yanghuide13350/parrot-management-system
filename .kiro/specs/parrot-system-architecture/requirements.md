# 鹦鹉管理系统架构规划 - 需求文档

## 简介

本文档定义了鹦鹉管理系统的完整业务需求。该系统是一个全生命周期的鹦鹉养殖和销售管理平台,涵盖从鹦鹉录入、配对繁殖、孵化管理到销售、回访、退货的完整业务流程。

## 核心业务流程说明

### 销售与退货的数据流转关系

系统采用**双表设计**来管理销售和退货数据:

1. **Parrot 表 (当前状态表)**

   - 存储鹦鹉的**当前销售信息** (seller, buyer_name, sale_price, contact 等)
   - 当鹦鹉处于"已售"状态时,这些字段有值
   - 当鹦鹉退货后,这些字段被清空,状态重置为"待售"

2. **SalesHistory 表 (历史记录表)**

   - 存储鹦鹉的**所有历史销售记录**
   - 每次退货时,将 Parrot 表的当前销售信息保存到此表
   - 包含 sale_date(销售时间)和 return_date(退货时间)
   - 支持一只鹦鹉多次销售和退货的完整历史追踪

3. **数据流转过程**:

   ```
   首次销售 → Parrot表记录当前销售信息 (status=sold)
   ↓
   发生退货 → 当前销售信息复制到SalesHistory表
   ↓
   清空Parrot表的销售字段 (status=available)
   ↓
   再次销售 → Parrot表记录新的销售信息 (status=sold)
   ↓
   再次退货 → 新销售信息复制到SalesHistory表
   ```

4. **页面展示逻辑**:
   - **销售记录页面**: 显示**当前在售**的鹦鹉 (Parrot 表中 status=sold 的记录)
   - **退货管理页面**: 显示**历史退货**记录 (SalesHistory 表中 return_date 不为空的记录)
   - **时间线页面**: 整合 Parrot 表当前销售 + SalesHistory 表历史记录,按时间排序展示完整生命周期

## 术语表

- **系统 (System)**: 鹦鹉管理系统
- **用户 (User)**: 使用系统的养殖场管理人员
- **鹦鹉 (Parrot)**: 系统管理的鹦鹉个体
- **圈号 (Ring Number)**: 鹦鹉的唯一标识编号
- **种鸟 (Breeding Bird)**: 用于繁殖的鹦鹉
- **配对 (Pairing)**: 将一公一母两只种鸟建立繁殖关系
- **孵化记录 (Incubation Record)**: 记录配对鹦鹉的繁殖和孵化过程
- **雏鸟 (Chick)**: 孵化出的幼鸟
- **销售记录 (Sales Record)**: 鹦鹉的销售交易信息
- **回访 (Follow-up)**: 对已售鹦鹉的售后跟踪
- **退货 (Return)**: 已售鹦鹉的退回处理
- **时间线 (Timeline)**: 鹦鹉从出生到当前的所有关键事件记录

## 需求

### 需求 1: 鹦鹉基础信息管理

**用户故事**: 作为养殖场管理员,我想要录入和管理鹦鹉的基础信息,以便追踪每只鹦鹉的详细资料。

#### 验收标准

1. WHEN 用户创建新鹦鹉记录 THEN 系统应当保存品种、性别、出生日期、圈号、价格区间和健康备注
2. WHEN 用户输入圈号 THEN 系统应当验证圈号的唯一性并在重复时拒绝创建
3. WHEN 用户设置价格区间 THEN 系统应当验证最低价格不高于最高价格
4. WHEN 用户查询鹦鹉列表 THEN 系统应当支持按品种、性别、状态、价格区间和年龄范围筛选
5. WHEN 用户上传照片或视频 THEN 系统应当关联到对应鹦鹉并支持多媒体文件格式

### 需求 2: 鹦鹉状态生命周期管理

**用户故事**: 作为养殖场管理员,我想要追踪鹦鹉的状态变化,以便了解每只鹦鹉当前的业务状态。

#### 验收标准

1. WHEN 鹦鹉首次录入系统 THEN 系统应当将状态设置为"待售"(available)
2. WHEN 用户将鹦鹉设为种鸟 THEN 系统应当将状态更新为"种鸟"(breeding)
3. WHEN 鹦鹉完成销售 THEN 系统应当将状态更新为"已售"(sold)并记录销售时间
4. WHEN 已售鹦鹉被退回 THEN 系统应当将状态重置为"待售"(available)并保留退货记录
5. WHEN 用户查询不同状态的鹦鹉 THEN 系统应当返回符合状态条件的鹦鹉列表

### 需求 3: 种鸟配对管理

**用户故事**: 作为养殖场管理员,我想要管理种鸟的配对关系,以便组织繁殖计划。

#### 验收标准

1. WHEN 用户配对两只鹦鹉 THEN 系统应当验证双方性别为一公一母
2. WHEN 用户配对两只鹦鹉 THEN 系统应当验证双方状态均为"种鸟"
3. WHEN 用户配对两只鹦鹉 THEN 系统应当验证双方均未与其他鹦鹉配对
4. WHEN 配对成功 THEN 系统应当建立双向关联并记录配对时间
5. WHEN 用户取消配对 THEN 系统应当清除双方的配对关系和配对时间
6. WHEN 用户查询公鹦鹉的可配对对象 THEN 系统应当返回所有未配对的种鸟母鹦鹉

### 需求 4: 孵化记录管理

**用户故事**: 作为养殖场管理员,我想要记录配对鹦鹉的孵化过程,以便追踪繁殖进度和结果。

#### 验收标准

1. WHEN 用户创建孵化记录 THEN 系统应当关联父鸟和母鸟的 ID
2. WHEN 用户创建孵化记录 THEN 系统应当记录开始日期和预计孵化日期
3. WHEN 用户更新孵化记录 THEN 系统应当允许修改状态和备注信息
4. WHEN 用户查询孵化记录 THEN 系统应当显示父母鸟信息和孵化进度
5. WHEN 用户删除孵化记录 THEN 系统应当级联删除相关的雏鸟记录

### 需求 5: 雏鸟管理

**用户故事**: 作为养殖场管理员,我想要记录孵化出的雏鸟信息,以便追踪每窝的繁殖成果。

#### 验收标准

1. WHEN 雏鸟孵化 THEN 系统应当关联到对应的孵化记录
2. WHEN 用户记录雏鸟 THEN 系统应当保存孵化日期、圈号和状态
3. WHEN 用户查询雏鸟 THEN 系统应当显示所属孵化记录和父母信息
4. WHEN 雏鸟成长 THEN 系统应当支持更新雏鸟状态和备注
5. WHEN 雏鸟长大 THEN 系统应当支持将雏鸟转为正式鹦鹉记录

### 需求 6: 销售流程管理

**用户故事**: 作为养殖场管理员,我想要记录鹦鹉的销售信息,以便管理销售业务和客户关系。

#### 验收标准

1. WHEN 用户售出鹦鹉 THEN 系统应当记录售卖人、购买者、销售价格和联系方式
2. WHEN 用户售出鹦鹉 THEN 系统应当将鹦鹉状态更新为"已售"并记录销售时间
3. WHEN 用户售出鹦鹉 THEN 系统应当初始化回访状态为"待回访"
4. WHEN 用户查询销售信息 THEN 系统应当返回完整的销售详情
5. WHEN 鹦鹉未售出 THEN 系统应当返回默认的销售信息占位符

### 需求 7: 售后回访管理

**用户故事**: 作为养殖场管理员,我想要记录对已售鹦鹉的回访情况,以便维护客户关系和了解鹦鹉状况。

#### 验收标准

1. WHEN 用户创建回访记录 THEN 系统应当记录回访时间、状态和备注
2. WHEN 用户创建回访记录 THEN 系统应当更新鹦鹉的当前回访状态
3. WHEN 用户查询回访记录 THEN 系统应当按时间倒序返回所有回访历史
4. WHEN 用户查询回访记录 THEN 系统应当支持分页显示
5. WHEN 回访状态变更 THEN 系统应当在时间线中记录该事件

### 需求 8: 退货处理

**用户故事**: 作为养殖场管理员,我想要处理鹦鹉的退货请求,以便重新上架销售并保留历史记录。

#### 验收标准

1. WHEN 用户处理退货 THEN 系统应当验证鹦鹉状态为"已售"
2. WHEN 用户处理退货 THEN 系统应当将当前销售信息保存到销售历史表
3. WHEN 用户处理退货 THEN 系统应当清除鹦鹉的当前销售信息
4. WHEN 用户处理退货 THEN 系统应当记录退货时间和退货原因
5. WHEN 用户处理退货 THEN 系统应当将鹦鹉状态重置为"待售"以支持重新销售

### 需求 9: 销售历史追踪

**用户故事**: 作为养殖场管理员,我想要查看鹦鹉的完整销售历史,以便了解鹦鹉的流转情况。

#### 验收标准

1. WHEN 鹦鹉发生退货 THEN 系统应当在销售历史表中保存该次销售的完整信息
2. WHEN 用户查询销售历史 THEN 系统应当返回该鹦鹉的所有历史销售记录
3. WHEN 用户查询销售历史 THEN 系统应当包含每次销售的退货信息
4. WHEN 鹦鹉多次销售 THEN 系统应当按时间顺序记录每次销售和退货
5. WHEN 查询时间线 THEN 系统应当整合销售历史和当前销售信息

### 需求 10: 销售流程时间线

**用户故事**: 作为养殖场管理员,我想要查看鹦鹉的完整生命周期时间线,以便全面了解鹦鹉的历史。

#### 验收标准

1. WHEN 用户查询时间线 THEN 系统应当包含鹦鹉的出生事件
2. WHEN 用户查询时间线 THEN 系统应当包含鹦鹉的录入系统事件
3. WHEN 用户查询时间线 THEN 系统应当包含所有历史销售事件及详情
4. WHEN 用户查询时间线 THEN 系统应当包含所有退货事件及原因
5. WHEN 用户查询时间线 THEN 系统应当包含所有回访记录及状态
6. WHEN 用户查询时间线 THEN 系统应当包含当前销售信息(如果存在)
7. WHEN 用户查询时间线 THEN 系统应当按时间顺序从早到晚排列所有事件

### 需求 11: 统计数据展示

**用户故事**: 作为养殖场管理员,我想要查看系统的统计数据,以便了解整体运营情况。

#### 验收标准

1. WHEN 用户访问仪表盘 THEN 系统应当显示鹦鹉总数统计
2. WHEN 用户访问仪表盘 THEN 系统应当显示各状态鹦鹉的数量
3. WHEN 用户访问仪表盘 THEN 系统应当显示总销售额和环比增长
4. WHEN 用户访问仪表盘 THEN 系统应当显示各品种的数量分布
5. WHEN 用户访问仪表盘 THEN 系统应当显示月度销售趋势图表
6. WHEN 用户点击统计卡片 THEN 系统应当跳转到对应筛选条件的列表页

### 需求 12: 照片和视频管理

**用户故事**: 作为养殖场管理员,我想要为鹦鹉上传和管理照片视频,以便展示鹦鹉的外观特征。

#### 验收标准

1. WHEN 用户上传文件 THEN 系统应当支持图片格式(png, jpg, jpeg, gif)
2. WHEN 用户上传文件 THEN 系统应当支持视频格式(mp4, mov, avi, mkv, webm)
3. WHEN 用户上传文件 THEN 系统应当验证文件大小不超过 500MB
4. WHEN 用户上传文件 THEN 系统应当自动识别文件类型并标记
5. WHEN 用户删除鹦鹉 THEN 系统应当级联删除该鹦鹉的所有照片和视频
6. WHEN 用户查询照片 THEN 系统应当按排序权重和创建时间返回

### 需求 13: 数据完整性和验证

**用户故事**: 作为系统,我需要确保数据的完整性和一致性,以便维护数据质量。

#### 验收标准

1. WHEN 创建或更新记录 THEN 系统应当验证所有必填字段非空
2. WHEN 设置价格区间 THEN 系统应当验证最低价格不大于最高价格
3. WHEN 配对鹦鹉 THEN 系统应当验证业务规则(性别、状态、配对状态)
4. WHEN 删除父记录 THEN 系统应当级联删除或更新子记录
5. WHEN 发生数据库约束冲突 THEN 系统应当返回友好的错误提示

### 需求 14: 前端路由和导航

**用户故事**: 作为用户,我想要通过清晰的导航访问各个功能模块,以便高效使用系统。

#### 验收标准

1. WHEN 用户访问根路径 THEN 系统应当重定向到仪表盘页面
2. WHEN 用户点击导航菜单 THEN 系统应当加载对应的功能页面
3. WHEN 页面加载 THEN 系统应当使用懒加载优化性能
4. WHEN 页面切换 THEN 系统应当显示加载动画
5. WHEN 路由不存在 THEN 系统应当显示 404 错误页面

### 需求 15: 用户界面主题

**用户故事**: 作为用户,我想要使用美观舒适的界面,以便获得良好的使用体验。

#### 验收标准

1. WHEN 系统加载 THEN 系统应当应用莫兰迪色系主题
2. WHEN 显示卡片 THEN 系统应当使用柔和的背景色和圆角设计
3. WHEN 显示图表 THEN 系统应当使用协调的配色方案
4. WHEN 用户交互 THEN 系统应当提供平滑的过渡动画
5. WHEN 显示数据 THEN 系统应当使用清晰的字体和合理的间距
