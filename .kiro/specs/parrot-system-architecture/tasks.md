# 鹦鹉管理系统 - 实施任务列表

## 任务概述

本任务列表将设计文档转化为可执行的开发任务。任务按照依赖关系组织,每个任务都明确引用相关需求。所有任务都是必做的,包括全面的属性测试,以确保系统的正确性和可靠性。

## 任务列表

- [x] 1. 完善后端 API - 销售记录和退货管理

  - 实现销售记录查询 API
  - 实现退货记录查询 API
  - 实现销售统计 API
  - _需求: 6, 8, 9_

- [x] 1.1 实现销售记录查询 API

  - 创建`GET /api/sales-records`端点
  - 支持筛选参数(keyword, breed, payment_method, date_range)
  - 返回当前在售鹦鹉列表(Parrot 表,status=sold)
  - 支持分页
  - _需求: 6.4_

- [x] 1.2 实现销售历史查询 API

  - 创建`GET /api/sales-history`端点
  - 支持筛选参数(keyword, has_return)
  - 返回 SalesHistory 表记录
  - 支持分页
  - _需求: 9.2, 9.3_

- [x] 1.3 实现销售统计 API

  - 创建`GET /api/statistics/sales`端点
  - 返回总销售额、销售数量、平均价格
  - 计算退货率
  - _需求: 11.3_

- [x] 1.4 实现退货统计 API

  - 创建`GET /api/statistics/returns`端点
  - 返回退货数量、退货率
  - _需求: 11.3_

- [ ]\* 1.5 编写属性测试 - 销售记录查询

  - **Property 17: 销售信息完整性**
  - **验证需求: 6.1**
  - 生成随机销售信息,售出鹦鹉,验证查询返回完整信息

- [ ]\* 1.6 编写属性测试 - 退货历史记录

  - **Property 22: 退货历史记录创建**
  - **验证需求: 8.2, 9.1**
  - 售出鹦鹉,退货,验证 SalesHistory 表有新记录

- [x] 2. 完善前端页面 - 销售记录页面

  - 实现销售记录列表展示
  - 实现筛选功能
  - 实现统计卡片
  - 实现详情查看
  - _需求: 6, 11_

- [x] 2.1 实现销售记录列表

  - 调用`GET /api/sales-records` API
  - 展示鹦鹉信息、客户信息、销售价格、销售日期
  - 支持分页
  - _需求: 6.4_

- [x] 2.2 实现销售记录筛选

  - 添加搜索框(客户姓名/圈号)
  - 添加品种下拉选择
  - 添加支付方式下拉选择
  - 添加日期范围选择
  - _需求: 6.4_

- [x] 2.3 实现销售统计卡片

  - 调用`GET /api/statistics/sales` API
  - 展示总销售额、销售数量、平均价格、退货率
  - _需求: 11.1, 11.3_

- [x] 2.4 实现销售详情 Modal

  - 展示完整的鹦鹉信息
  - 展示完整的客户信息
  - 展示销售信息和回访状态
  - _需求: 6.4_

- [x] 3. 完善前端页面 - 退货管理页面

  - 实现退货记录列表展示
  - 实现筛选功能
  - 实现统计卡片
  - 实现详情查看
  - _需求: 8, 9, 11_

- [x] 3.1 实现退货记录列表

  - 调用`GET /api/sales-history?has_return=true` API
  - 展示鹦鹉信息、销售信息、退货信息
  - 支持分页
  - _需求: 9.2_

- [x] 3.2 实现退货记录筛选

  - 添加搜索框(客户姓名/圈号)
  - _需求: 9.2_

- [x] 3.3 实现退货统计卡片

  - 调用`GET /api/statistics/returns` API
  - 展示退货数量、退货率
  - _需求: 11.3_

- [x] 3.4 实现退货详情 Modal

  - 展示完整的鹦鹉信息
  - 展示销售信息
  - 展示退货信息(退货日期、退货原因)
  - _需求: 9.2_

- [x] 4. 优化数据完整性和验证

  - 完善价格区间验证
  - 完善配对验证
  - 完善状态转换验证
  - 添加数据库索引
  - _需求: 13_

- [x] 4.1 完善价格区间验证

  - 在创建和更新 API 中验证 min_price <= max_price
  - 返回友好的错误提示
  - _需求: 1.3, 13.2_

- [ ]\* 4.2 编写属性测试 - 价格区间验证

  - **Property 3: 价格区间验证**
  - **验证需求: 1.3, 13.2**
  - 生成随机价格组合,验证系统正确接受或拒绝

- [x] 4.3 完善配对验证

  - 验证性别(一公一母)
  - 验证状态(双方为 breeding)
  - 验证配对状态(双方未配对)
  - 返回友好的错误提示
  - _需求: 3.1, 3.2, 3.3, 13.3_

- [ ]\* 4.4 编写属性测试 - 配对验证

  - **Property 11: 配对性别验证**
  - **Property 12: 配对状态验证**
  - **Property 13: 配对唯一性验证**
  - **验证需求: 3.1, 3.2, 3.3**
  - 生成不同性别和状态组合,验证配对规则

- [x] 4.5 添加数据库索引

  - 为 breed, status, ring_number 添加索引
  - 为 sale_date, return_date, sold_at 添加索引
  - 优化查询性能
  - _需求: 13_

- [ ] 5. 实现核心属性测试

  - 设置 Hypothesis 测试框架
  - 实现鹦鹉创建相关属性测试
  - 实现状态转换相关属性测试
  - 实现销售流程相关属性测试
  - _需求: 所有需求_

- [ ] 5.1 设置 Hypothesis 测试框架

  - 安装 hypothesis 库
  - 配置 pytest
  - 创建测试数据生成器
  - 配置每个测试运行 100+次迭代

- [ ]\* 5.2 编写属性测试 - 鹦鹉创建

  - **Property 1: 鹦鹉创建完整性**
  - **Property 2: 圈号唯一性约束**
  - **Property 6: 初始状态正确性**
  - **验证需求: 1.1, 1.2, 2.1**
  - 生成随机鹦鹉数据,验证创建和查询

- [ ]\* 5.3 编写属性测试 - 筛选功能

  - **Property 4: 筛选结果正确性**
  - **Property 10: 状态筛选正确性**
  - **验证需求: 1.4, 2.5**
  - 创建多个鹦鹉,用不同筛选条件查询,验证结果

- [ ]\* 5.4 编写属性测试 - 照片管理

  - **Property 5: 照片关联完整性**
  - **Property 26: 级联删除完整性**
  - **验证需求: 1.5, 13.4**
  - 上传照片,验证关联;删除鹦鹉,验证级联删除

- [ ]\* 5.5 编写属性测试 - 状态转换

  - **Property 7: 状态转换正确性**
  - **Property 8: 销售状态更新**
  - **Property 9: 退货状态重置**
  - **验证需求: 2.2, 2.3, 2.4, 6.2, 8.3, 8.5**
  - 测试 available→breeding, available→sold, sold→available 转换

- [ ]\* 5.6 编写属性测试 - 配对功能

  - **Property 14: 配对双向关联**
  - **Property 15: 取消配对完整性**
  - **Property 16: 可配对对象查询正确性**
  - **验证需求: 3.4, 3.5, 3.6**
  - 测试配对、取消配对、查询可配对对象

- [ ]\* 5.7 编写属性测试 - 销售流程

  - **Property 18: 销售初始化回访状态**
  - **Property 19: 回访记录创建完整性**
  - **Property 20: 回访状态同步**
  - **验证需求: 6.3, 7.1, 7.2**
  - 测试售出、回访记录创建、状态同步

- [ ]\* 5.8 编写属性测试 - 退货流程

  - **Property 21: 退货状态验证**
  - **Property 23: 退货信息记录**
  - **Property 24: 多次销售历史完整性**
  - **验证需求: 8.1, 8.4, 9.4**
  - 测试退货验证、退货信息、多次销售

- [ ]\* 5.9 编写属性测试 - 时间线

  - **Property 25: 时间线事件排序**
  - **验证需求: 10.7**
  - 创建鹦鹉,进行多次操作,验证时间线排序

- [ ] 6. Checkpoint - 确保所有测试通过

  - 确保所有测试通过,如有问题请询问用户

- [x] 7. 优化前端用户体验

  - 优化加载状态
  - 优化错误提示
  - 优化表单验证
  - 优化响应式布局
  - _需求: 14, 15_

- [x] 7.1 优化加载状态

  - 添加 Skeleton 加载占位符
  - 优化 Spin 组件使用
  - 添加数据加载进度提示
  - _需求: 14.4_

- [x] 7.2 优化错误提示

  - 统一错误提示样式
  - 添加错误详情展示
  - 优化网络错误处理
  - _需求: 14.4_

- [x] 7.3 优化表单验证

  - 添加实时验证
  - 优化验证错误提示
  - 添加圈号唯一性实时检查
  - _需求: 1.2, 14.4_

- [x] 7.4 优化响应式布局

  - 优化移动端显示
  - 优化表格横向滚动
  - 优化 Modal 在小屏幕的显示
  - _需求: 15_

- [x] 8. 文档和部署

  - 更新 API 文档
  - 更新 README
  - 准备生产环境配置
  - 编写部署脚本
  - _需求: 所有需求_

- [x] 8.1 更新 API 文档

  - 更新 Swagger 文档
  - 添加新 API 端点说明
  - 添加请求/响应示例

- [x] 8.2 更新 README

  - 更新项目结构说明
  - 更新 API 接口列表
  - 更新部署指南

- [x] 8.3 准备生产环境配置

  - 配置 MySQL 数据库
  - 配置环境变量
  - 配置 Nginx 反向代理

- [x] 8.4 编写部署脚本

  - 编写数据库迁移脚本
  - 编写自动部署脚本
  - 编写备份脚本

- [ ] 9. Final Checkpoint - 确保所有测试通过
  - 确保所有测试通过,如有问题请询问用户
