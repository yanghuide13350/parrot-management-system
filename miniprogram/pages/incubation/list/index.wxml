<view class="page">
  <view class="filter-bar">
    <view class="filter-item" bindtap="toggleFilter">
      <text class="filter-text">ç­›é€‰</text>
      <text class="filter-icon">â–¼</text>
    </view>
    <view class="quick-filters">
      <view class="quick-filter-item" bindtap="resetFilter">å…¨éƒ¨</view>
    </view>
  </view>

  <view class="filter-drawer {{showFilter ? 'show' : ''}}">
    <view class="filter-content">
      <view class="filter-group">
        <view class="filter-label">çŠ¶æ€</view>
        <picker mode="selector" range="{{statusList}}" range-key="label" value="0" bindchange="onStatusChange">
          <view class="filter-value">{{statusLabel}}</view>
        </picker>
      </view>

      <view class="filter-group">
        <view class="filter-label">å¼€å§‹æ—¥æœŸä»</view>
        <picker mode="date" bindchange="onStartDateFromChange">
          <view class="filter-value">{{filters.startDateFrom || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>

      <view class="filter-group">
        <view class="filter-label">å¼€å§‹æ—¥æœŸåˆ°</view>
        <picker mode="date" bindchange="onStartDateToChange">
          <view class="filter-value">{{filters.startDateTo || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>

      <view class="filter-group">
        <view class="filter-label">æœç´¢</view>
        <input class="filter-input" placeholder="æœç´¢çˆ¶æ¯é¸Ÿåœˆå·" value="{{filters.search}}" bindinput="onSearchInput" />
      </view>

      <view class="filter-actions">
        <button class="filter-btn reset" bindtap="resetFilter">é‡ç½®</button>
        <button class="filter-btn apply" bindtap="applyFilter">åº”ç”¨</button>
      </view>
    </view>
  </view>

  <view class="list">
    <view class="incubation-card glass-card" wx:for="{{list}}" wx:key="id">
      <view class="card-header">
        <view class="status-badge status-{{item.status}}">{{item.statusText}}</view>
        <view class="start-date">{{item.startDateText}}</view>
        <view class="incubation-days" wx:if="{{item.incubationDays}}">{{item.incubationDays}}</view>
      </view>
      <view class="card-body">
        <view class="parents">
          <view class="parent-item">
            <text class="parent-label">çˆ¶:</text>
            <text class="parent-value">{{item.father ? (item.father.ring_number || item.father.breed) : 'æœªçŸ¥'}}</text>
          </view>
          <view class="parent-item">
            <text class="parent-label">æ¯:</text>
            <text class="parent-value">{{item.mother ? (item.mother.ring_number || item.mother.breed) : 'æœªçŸ¥'}}</text>
          </view>
        </view>
        <view class="eggs-info">
          <text class="eggs-count">{{item.eggs_count}}æšè›‹</text>
          <text class="hatched-count">å·²å­µåŒ– {{item.hatched_count}}åª</text>
          <text class="hatch-rate" wx:if="{{item.hatchRate}}">å­µåŒ–ç‡ {{item.hatchRate}}</text>
        </view>
      </view>
      <view class="card-footer" wx:if="{{item.status !== 'completed'}}">
        <button class="action-btn {{item.eggs_count > (item.hatched_count || 0) ? 'edit-btn' : 'complete-btn'}}" data-id="{{item.id}}" data-eggs="{{item.eggs_count}}" data-hatched="{{item.hatched_count}}" bindtap="showUpdateDialog">{{item.eggs_count > (item.hatched_count || 0) ? 'æ›´æ–°' : 'å®Œæˆ'}}</button>
        <button class="action-btn delete-btn" data-id="{{item.id}}" bindtap="deleteRecord">åˆ é™¤</button>
      </view>
      <view class="card-footer" wx:if="{{item.status === 'completed'}}">
        <button class="action-btn delete-btn" data-id="{{item.id}}" bindtap="deleteRecord">åˆ é™¤</button>
      </view>
    </view>

    <empty-state wx:if="{{!list.length && !loading}}" icon="ğŸ¥š" text="æš‚æ— å­µåŒ–è®°å½•" />
  </view>

  <view class="fab" bindtap="goAdd">
    <text class="fab-icon">+</text>
  </view>

  <view class="update-dialog" wx:if="{{showUpdateDialog}}">
    <view class="dialog-mask" bindtap="hideUpdateDialog"></view>
    <view class="dialog-content">
      <view class="dialog-header">
        <text class="dialog-title">æ›´æ–°å­µåŒ–è®°å½•</text>
      </view>
      <view class="dialog-body">
        <view class="form-item">
          <text class="form-label"><text class="required">*</text> æœ¬æ¬¡å­µåŒ–æ•°é‡</text>
          <input type="number" placeholder="è¯·è¾“å…¥æ•°é‡" value="{{updateHatchedCount}}" bindinput="onUpdateHatchedInput" />
        </view>
        <view class="hint-text">å‰©ä½™è›‹æ•°ï¼š{{remainingEggs}}æš</view>
      </view>
      <view class="dialog-footer">
        <button class="dialog-btn cancel" bindtap="hideUpdateDialog">å–æ¶ˆ</button>
        <button class="dialog-btn confirm" bindtap="confirmUpdate">ç¡®å®š</button>
      </view>
    </view>
  </view>

</view>
